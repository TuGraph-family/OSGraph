#!/bin/bash
set -x
# 在tumaker 根目录执行这个脚本
opensourceTad=opensource

cp -r Dockerfile	README_CN.md		build.sh		mvnw			pom_inc.xml		target Dockerfile_aarch64	app			conf			mvnw.cmd		pom_opensource.xml	tumaker-parent.iml README.md	biz	dalgen	pom.xml	tumaker.iml ./source
cd ./source/
#替换pom

if [[ -e pom_${opensourceTad}.xml ]];then
  cp pom_${opensourceTad}.xml pom.xml;
fi
if [[ -e app/bootstrap/src/main/resources/spring/bootstrap_${opensourceTad}.xml ]];then
  cp app/bootstrap/src/main/resources/spring/bootstrap_${opensourceTad}.xml app/bootstrap/src/main/resources/spring/bootstrap.xml;
fi
if [[ -e app/biz/service-impl/pom_${opensourceTad}.xml ]];then
  cp app/biz/service-impl/pom_${opensourceTad}.xml app/biz/service-impl/pom.xml;
fi
if [[ -e app/biz/shared/pom_${opensourceTad}.xml ]];then
  cp app/biz/shared/pom_${opensourceTad}.xml app/biz/shared/pom.xml;
fi
if [[ -e app/bootstrap/pom_${opensourceTad}.xml ]];then
  cp app/bootstrap/pom_${opensourceTad}.xml app/bootstrap/pom.xml;
fi
if [[ -e app/common/dal/pom_${opensourceTad}.xml ]];then
  cp app/common/dal/pom_${opensourceTad}.xml app/common/dal/pom.xml;
fi
if [[ -e app/common/facade/pom_${opensourceTad}.xml ]];then
  cp app/common/facade/pom_${opensourceTad}.xml app/common/facade/pom.xml;
fi
if [[ -e app/common/util/pom_${opensourceTad}.xml ]];then
  cp app/common/util/pom_${opensourceTad}.xml app/common/util/pom.xml;
fi
if [[ -e app/core/model/pom_${opensourceTad}.xml ]];then
  cp app/core/model/pom_${opensourceTad}.xml app/core/model/pom.xml;
fi
if [[ -e app/core/service/pom_${opensourceTad}.xml ]];then
  cp app/core/service/pom_${opensourceTad}.xml app/core/service/pom.xml;
fi
if [[ -e app/serviceplugin/devops/pom_${opensourceTad}.xml ]];then
  cp app/serviceplugin/devops/pom_${opensourceTad}.xml app/serviceplugin/devops/pom.xml;
fi
if [[ -e app/spi/agent/pom_${opensourceTad}.xml ]];then
  cp app/spi/agent/pom_${opensourceTad}.xml app/spi/agent/pom.xml;
fi
if [[ -e app/spi/spi-core/pom_${opensourceTad}.xml ]];then
  cp app/spi/spi-core/pom_${opensourceTad}.xml app/spi/spi-core/pom.xml;
fi
if [[ -e app/web/home/pom_${opensourceTad}.xml ]];then
  cp app/web/home/pom_${opensourceTad}.xml app/web/home/pom.xml;
fi
#替换 property
mv app/bootstrap/src/main/resources/config app/bootstrap/src/main/resources/config_inc
mv app/bootstrap/src/main/resources/config_opensource app/bootstrap/src/main/resources/config
#裁剪冗余的配置
rm -rf pom_${opensourceTad}.xml
rm -rf app/biz/service-impl/pom_${opensourceTad}.xml
rm -rf app/biz/shared/pom_${opensourceTad}.xml
rm -rf app/bootstrap/pom_${opensourceTad}.xml
rm -rf app/common/dal/pom_${opensourceTad}.xml
rm -rf app/common/facade/pom_${opensourceTad}.xml
rm -rf app/common/util/pom_${opensourceTad}.xml
rm -rf app/core/model/pom_${opensourceTad}.xml
rm -rf app/core/service/pom_${opensourceTad}.xml
rm -rf app/serviceplugin/devops/pom_${opensourceTad}.xml
rm -rf app/spi/agent/pom_${opensourceTad}.xml
rm -rf app/spi/spi-core/pom_${opensourceTad}.xml
rm -rf app/web/home/pom_${opensourceTad}.xml
#裁剪闭源的功能
for line in `cat biz/opensource/closed_source.conf`
do
  echo $line
done




